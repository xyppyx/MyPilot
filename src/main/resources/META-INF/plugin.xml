<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.javaee.MyPilot</id>

    <name>MyPilot</name>

    <vendor email="2354093@tongji.edu.cn" url="https://github.com/xyppyx/MyPilot">徐云鹏、陈艺龙、李雪菲</vendor>

    <description><![CDATA[
        <h2>MyPilot — JavaEE 课程学习助手（RAG + Agent）</h2>
        <p>为课堂学习与项目开发打造的 AI Coding 插件，提供 <b>RAG 检索增强问答</b> 与 <b>Agent 智能改码</b> 两大能力，深度集成到 IntelliJ IDEA。</p>
        <h3>特性</h3>
        <ul>
          <li><b>ASK（RAG）</b>：基于项目/课件资料进行检索增强，精准引用代码与文档</li>
          <li><b>AGENT</b>：生成改动并以 Diff 方式呈现，安全、可审阅地应用到项目</li>
          <li><b>右键菜单/快捷键</b>：Alt+M 添加代码引用；支持文件/文件夹一键加入上下文</li>
          <li><b>工具窗口</b>：右侧聊天面板，支持会话管理与代码引用卡片跳转</li>
        </ul>
    ]]></description>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Register the chat tool window -->
        <toolWindow id="MyPilot"
                    factoryClass="com.javaee.mypilot.view.ui.ToolWindowFactory"
                    anchor="right"
                    icon="/META-INF/teachingAssistant.svg"/>
        
        <!-- Register settings page: Settings → Tools → MyPilot -->
        <projectConfigurable 
                parentId="tools"
                instance="com.javaee.mypilot.view.ui.MyPilotConfigurable"
                id="settings.mypilot"
                displayName="MyPilot"
                nonDefaultProject="true"/>

        <!-- Register project startup activity for RAG service initialization -->
        <postStartupActivity implementation="com.javaee.mypilot.MyPilotProjectComponent"/>
    </extensions>
    
    <!-- Actions -->
    <actions>
        <!-- 右键菜单组：MyPilot -->
        <group id="MyPilot.EditorContextMenu" text="MyPilot" popup="true">
            <!-- 1. 打开 MyPilot 聊天窗口 -->
            <action id="MyPilot.OpenChatWindow"
                    class="com.javaee.mypilot.view.action.OpenChatWindowAction"
                    text="打开聊天窗口"
                    description="打开 MyPilot 聊天工具窗口">
            </action>
            
            <!-- 2. 添加代码引用到聊天 -->
            <action id="MyPilot.AddCodeReference"
                    class="com.javaee.mypilot.view.action.AddCodeReferenceAction"
                    text="添加代码引用"
                    description="将选中的代码添加到 MyPilot 聊天引用区">
                <!-- 快捷键: Alt+M -->
                <keyboard-shortcut keymap="$default" first-keystroke="alt M"/>
            </action>
            
            <!-- 添加到编辑器右键菜单 -->
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>
        
        <!-- 文件右键菜单组：MyPilot -->
        <group id="MyPilot.ProjectViewPopupMenu" text="MyPilot" popup="true">
            <!-- 添加文件代码引用到聊天 -->
            <action id="MyPilot.AddFileCodeReference"
                    class="com.javaee.mypilot.view.action.AddFileCodeReferenceAction"
                    text="添加文件代码到聊天"
                    description="将整个文件的所有代码添加到 MyPilot 聊天引用区">
            </action>
            
            <!-- 添加文件夹代码引用到聊天 -->
            <action id="MyPilot.AddDirectoryCodeReference"
                    class="com.javaee.mypilot.view.action.AddDirectoryCodeReferenceAction"
                    text="添加文件夹代码到聊天"
                    description="将文件夹下所有子文件的所有代码添加到 MyPilot 聊天引用区">
            </action>
            
            <!-- 添加到项目文件树右键菜单 -->
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
        </group>
    </actions>
</idea-plugin>
